<!-- HTML page -->
<html>
  <head>
    <link rel="icon" href="/Favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="/Favicons/favicon-16x16.png" sizes="16x16" />
    <title>Funny Memes and Viral Content - Your Daily Dose of Laughter</title>
    <meta name="description" content="Get your daily dose of laughter with our collection of hilarious jokes.">

      <link rel="stylesheet" href="/jokes.css">

  </head>
   <body>
    <div id="joke-container">
      <!-- Joke will be inserted here -->
        <div id="average-rating-container"></div>
    </div>
     
     <form id="rating-form">
  <label for="rating">Rate this joke:</label>
  <input type="range" min="1" max="5" value="3" id="rating">
  <button type="submit">Submit</button>
</form>
    <!-- Average rating will be inserted here -->
  </div>
     
    <button onclick="getJoke()">Show me a joke!</button>
    <button onclick="copyJoke()" id="copy-button">Copy joke</button>
    <button onclick="saveMeme()">Save Joke</button>

       <footer>
      Made by ChatGPT
      <button onclick="window.location.href='/savedjokes';" class="footer-button">View Saved Jokes</button>
    </footer>
  </body>
  

<!-- Include the Firebase JavaScript library -->
<script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.21.1/firebase-database.js"></script>

<!-- Include the axios library for making HTTP requests -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script src="code.js"></script>    
   
<script>
      // Initialize Firebase
const firebaseConfig = {
 apiKey: "AIzaSyD9J8Zo7shjTli5RRIMZXt-ffkr_yPZB6s",
  authDomain: "database-4968f.firebaseapp.com",
  databaseURL: "https://database-4968f-default-rtdb.firebaseio.com",
  projectId: "database-4968f",
  storageBucket: "database-4968f.appspot.com",
  messagingSenderId: "165048515702",
  appId: "1:165048515702:web:1ff5d368bc00ae5a817357"
};
firebase.initializeApp(firebaseConfig);

const database = firebase.database();

// Set up the database reference for storing and retrieving joke ratings
const jokesRef = database.ref("jokes");


async function getJoke() {
  const response = await fetch('https://v2.jokeapi.dev/joke/Any?blacklistFlags=religious,political,racist,sexist');
  const joke = await response.json();

  if (joke.text) {
    // Display the joke if it has a "text" property
    displayJoke(joke.text);
  } else {
    displayJoke('Joke received from API does not have a "text" property');
  }
}


function displayJoke(joke) {
  const jokeContainer = document.getElementById('joke-container');
  jokeContainer.innerText = joke;
}


// Displays the average rating for the specified joke
async function displayAverageRating(joke) {
  // Remove any special characters from the joke
  const safeJoke = joke.replace(/[^a-zA-Z0-9]/g, '');

  // Get the joke's ratings from the database
  const ratingsRef = firebase.database().ref(`jokes/${safeJoke}/ratings`);
  const snapshot = await ratingsRef.once('value');
  const ratings = snapshot.val();

  // Calculate the average rating
  let total = 0;
  let count = 0;
  for (const rating in ratings) {
    total += ratings[rating];
    count++;
  }
  const average = total / count;

  // Display the average rating in the average rating container
  const averageRatingContainer = document.getElementById('average-rating-container');
  averageRatingContainer.innerHTML = `Average rating: ${average}`;
}

// Submits the rating for the current joke
async function submitRating(event) {
  // Prevent the form from refreshing the page
  event.preventDefault();

  // Get the rating from the form
  const form = document.getElementById('rating-form');
  const rating = form.elements.rating.value;

  // Get the joke from the joke container
  const jokeContainer = document.getElementById('joke-container');
  const joke = jokeContainer.innerHTML;

  // Remove any special characters from the joke
  const safeJoke = joke.replace(/[^a-zA-Z0-9]/g, '');

  // Add the rating to the database
  const ratingsRef = firebase.database().ref(`jokes/${safeJoke}/ratings`);
  ratingsRef.push(rating);

  // Display the updated average rating
  displayAverageRating(joke);
}
  
  getJoke();



</script>
</html>
