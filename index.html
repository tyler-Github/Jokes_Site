<!-- HTML page -->
<html>
  <head>
    <link rel="icon" href="/Favicons/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="/Favicons/favicon-16x16.png" sizes="16x16" />
    <title>Funny Memes and Viral Content - Your Daily Dose of Laughter</title>
    <meta name="description" content="Get your daily dose of laughter with our collection of hilarious jokes.">

      <link rel="stylesheet" href="/jokes.css">

  </head>
   <body>
    <div id="joke-container">
      <!-- Joke will be inserted here -->
    </div>
     
     <form id="rating-form">
  <label for="rating">Rate this joke:</label>
  <input type="range" min="1" max="5" value="3" id="rating">
  <button type="submit">Submit</button>
</form>
      <div id="average-rating-container">
    <!-- Average rating will be inserted here -->
  </div>
     
    <button onclick="getJoke()">Show me a joke!</button>
    <button onclick="copyJoke()" id="copy-button">Copy joke</button>
    <button onclick="saveMeme()">Save Joke</button>

       <footer>
      Made by ChatGPT
      <button onclick="window.location.href='/savedjokes';" class="footer-button">View Saved Jokes</button>
    </footer>
  </body>
  
  <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script>

  <script>
    
    document.getElementById("rating-form").addEventListener("submit", submitRating);

    // Initialize Firebase
const firebaseConfig = {
 apiKey: "AIzaSyD9J8Zo7shjTli5RRIMZXt-ffkr_yPZB6s",
  authDomain: "database-4968f.firebaseapp.com",
  databaseURL: "https://database-4968f-default-rtdb.firebaseio.com",
  projectId: "database-4968f",
  storageBucket: "database-4968f.appspot.com",
  messagingSenderId: "165048515702",
  appId: "1:165048515702:web:1ff5d368bc00ae5a817357"
};
firebase.initializeApp(firebaseConfig);

const database = firebase.database();

async function getJoke() {
  const response = await fetch('https://v2.jokeapi.dev/joke/Any?blacklistFlags=nsfw,racist');
  const data = await response.json();
  const joke = data.joke;

  // remove special characters from joke name
  const jokeName = joke.replace(/[^a-zA-Z0-9]/g, '');

  // insert joke into page
  const jokeContainer = document.querySelector('#joke-container');
  jokeContainer.textContent = joke;

  // submit rating
  const form = document.querySelector('#rating-form');
  form.addEventListener('submit', e => {
    e.preventDefault();
    const rating = form.elements.rating.value;
    submitRating(jokeName, rating);
  });

  // fetch average rating
  const ratingsRef = firebase.database().ref(`jokes/${jokeName}/ratings`);
  ratingsRef.on('value', snapshot => {
    const ratings = snapshot.val();
    let total = 0;
    let count = 0;
    for (const rating in ratings) {
      total += ratings[rating];
      count++;
    }
    const average = total / count;
    const ratingContainer = document.querySelector('#rating-container');
    ratingContainer.textContent = `Average rating: ${average}`;
  });
}

function submitRating(jokeName, rating) {
  firebase.database().ref(`jokes/${jokeName}/ratings`).push(rating);
}

getJoke();

    

async function displayJoke() {
  const joke = await getJoke();
  const jokeContainer = document.getElementById('joke-container');
  const jokeText = joke.joke;
  jokeContainer.innerText = jokeText;

  // Remove special characters from joke name
  const jokeName = jokeText.replace(/[^\w\s]/gi, '');

  // Get average rating for joke from database
  const ratingsRef = database.ref(`jokes/${jokeName}/ratings`);
  const snapshot = await ratingsRef.once('value');
  const ratings = snapshot.val();
  let sum = 0;
  let count = 0;
  for (const rating in ratings) {
    sum += ratings[rating];
    count += 1;
  }
  const avgRating = sum / count;

  // Display rating
  const ratingContainer = document.getElementById('rating-container');
  ratingContainer.innerText = `Rating: ${avgRating}`;
}

function submitRating(event) {
  event.preventDefault();

  // Get joke and rating from form
  const form = event.target;
  const rating = form.elements.rating.value;
  const jokeContainer = document.getElementById('joke-container');
  const jokeText = jokeContainer.innerText;

  // Remove special characters from joke name
  const jokeName = jokeText.replace(/[^\w\s]/gi, '');

  // Add rating to database
  const ratingsRef = database.ref(`jokes/${jokeName}/ratings`);
  ratingsRef.push(rating);
}

const form = document.getElementById('rating-form');
form.addEventListener('submit', submitRating);
displayJoke();

    
    // JavaScript function to get a joke from the Joke API and insert it into the page
    function getJoke() {
      // Make a GET request to the Joke API
      fetch("https://v2.jokeapi.dev/joke/Any?blacklistFlags=nsfw,racist")
        .then(response => response.json()) // Parse the response as JSON
        .then(data => {
          // Check the type of the joke
          if (data.type === "single") {
            // If it is a single joke, display the joke property
            document.getElementById("joke-container").innerHTML = data.joke;
          } else if (data.type === "twopart") {
            // If it is a two-part joke, concatenate the setup and delivery properties
            document.getElementById("joke-container").innerHTML = data.setup + " " + data.delivery;
          }
        })
        .catch(error => {
          // If there is an error, display an error message
          document.getElementById("joke-container").innerHTML = "Error loading joke";
        });
    }

    // JavaScript function to copy the joke to the clipboard
    function copyJoke() {
      // Get the joke text
      const joke = document.getElementById("joke-container").innerText;

      // Create a temporary textarea element
      const textarea = document.createElement("textarea");
      textarea.value = joke;
      document.body.appendChild(textarea);

      // Select the text in the textarea
      textarea.select();

      // Copy the text to the clipboard
      document.execCommand("copy");

      // Remove the textarea element
      document.body.removeChild(textarea);
    }

      function saveMeme() {
        // Get the URL of the current meme
        var currentMemeUrl = document.getElementById("joke-container").innerText;
        // Get the saved memes from local storage
        var savedMemes = JSON.parse(localStorage.getItem("jokes")) || [];
        // Add the current meme to the list of saved memes
        savedMemes.push(currentMemeUrl);
        // Store the updated list of saved memes in local storage
        localStorage.setItem("jokes", JSON.stringify(savedMemes));
      }

      function warnAndSendJoke() {
  console.warn("%cDo not paste anything into the console because it can potentially harm your computer or steal your information!", "color: red; font-size: larger;");

  // Get a joke from the joke API
  fetch("https://v2.jokeapi.dev/joke/Any?blacklistFlags=nsfw,racist")
    .then(response => response.json())
    .then(data => {
      // Check if the API response includes a joke
      if (data.joke) {
        // Display the joke in the console
        console.log("%c" + data.joke, "color: green; font-size: larger;");

        // Display a message saying that ChatGPT made this website with some styling
        console.log("%cMade by ChatGPT", "color: blue; font-size: smaller; font-style: italic; text-decoration: underline;");
      } else {
        // Display an error message in the console
        console.error("Unable to get joke.");
      }
    })
    .catch(error => {
      // Display an error message in the console
      console.error("An error occurred while fetching the joke: " + error);
    });
}



async function getAverageRating() {
  // First, get the joke name from the joke container element
  const jokeName = document.getElementById("joke-container").textContent;

  // Next, get the ratings for the joke from the database
  const ratingsRef = firebase.database().ref(`jokes/${jokeName}/ratings`);
  const snapshot = await ratingsRef.once('value');
  const ratings = snapshot.val();

  // Calculate the average rating
  let sum = 0;
  let count = 0;
  for (const rating of Object.values(ratings)) {
    sum += rating;
    count++;
  }
  const averageRating = sum / count;

  // Display the average rating on the page
  const ratingElement = document.getElementById("rating");
  ratingElement.innerHTML = `Average rating: ${averageRating}`;
}

getAverageRating();



warnAndSendJoke();
  </script>
</html>
